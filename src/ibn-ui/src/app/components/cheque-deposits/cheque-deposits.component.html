<div class="cheque-deposit-component">
  <!-- Personal User View: Cheque Deposit Form -->
  <ng-container *ngIf="userType === 'personal'">
    <p class="intro-text">
      Deposit cheques issued in your name by filling the online bank slip. You can submit the
      details and print the filled slip.
    </p>

    <form class="deposit-form" (ngSubmit)="onSubmit()" #depositForm="ngForm">
      <div class="form-grid">
        <div class="form-row">
          <label for="depositorName">Depositor Name</label>
          <input
            id="depositorName"
            name="depositorName"
            type="text"
            [(ngModel)]="depositRequest.depositorName"
            placeholder="Enter depositor name"
            required
          />
        </div>

        <div class="form-row">
          <label for="fromAccount">Deposit To Account</label>
          <select
            id="fromAccount"
            name="fromAccount"
            [(ngModel)]="depositRequest.toAccount"
            required
          >
            <option value="" disabled>Select account</option>
            <option *ngFor="let account of toAccounts" [value]="account.accountId">
              {{ account.accountType }} - {{ account.accountNumber }}
            </option>
          </select>
        </div>

        <div class="form-row">
          <label for="chequeNumber">Cheque Number</label>
          <input
            id="chequeNumber"
            name="chequeNumber"
            type="text"
            [(ngModel)]="depositRequest.chequeNumber"
            placeholder="Enter cheque number"
            required
          />
        </div>

        <div class="form-row">
          <label for="chequeDate">Cheque Date</label>
          <input
            id="chequeDate"
            name="chequeDate"
            type="date"
            [(ngModel)]="depositRequest.chequeDate"
            required
          />
        </div>

        <div class="form-row">
          <label for="bankName">Bank Name</label>
          <input
            id="bankName"
            name="bankName"
            type="text"
            [(ngModel)]="depositRequest.bankName"
            placeholder="Enter bank name"
            required
          />
        </div>

        <div class="form-row">
          <label for="branchName">Branch Name</label>
          <input
            id="branchName"
            name="branchName"
            type="text"
            [(ngModel)]="depositRequest.branchName"
            placeholder="Enter branch name"
            required
          />
        </div>

        <div class="form-row">
          <label for="amount">Amount</label>
          <input
            id="amount"
            name="amount"
            type="number"
            min="1"
            step="0.01"
            [(ngModel)]="depositRequest.amount"
            placeholder="Enter amount"
            required
          />
        </div>

        <div class="form-row">
          <label for="remarks">Remarks</label>
          <textarea
            id="remarks"
            name="remarks"
            rows="3"
            [(ngModel)]="depositRequest.remarks"
            placeholder="Optional remarks"
          ></textarea>
        </div>

        <div class="form-row">
          <label for="attachment">Attachment (optional)</label>
          <input
            id="attachment"
            name="attachment"
            type="file"
            accept=".png,.jpg,.jpeg"
            (change)="onFileSelected($event)"
          />
          <small *ngIf="selectedFileName" class="file-name">Selected: {{ selectedFileName }}</small>
        </div>
      </div>

      <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

      <div class="actions">
        <button type="submit" class="primary-btn" [disabled]="!depositForm.form.valid || isSubmitting">
          {{ isSubmitting ? 'Submitting...' : 'Submit' }}
        </button>
        <button type="button" class="secondary-btn" (click)="printSlip()" [disabled]="!canPrint">
          Print Slip
        </button>
      </div>
    </form>

    <div class="success-message" *ngIf="showSuccessMessage">
      Cheque deposit submitted successfully. Reference ID: <strong>{{ referenceId }}</strong>
    </div>

    <div class="saved-section">
      <h3>Saved Cheque Deposits</h3>
      <table class="saved-table">
        <thead>
          <tr>
            <th>Reference ID</th>
            <th>Depositor</th>
            <th>Account</th>
            <th>Cheque No.</th>
            <th>Date</th>
            <th>Bank</th>
            <th>Branch</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Attachment</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of savedDeposits">
            <td>{{ item.referenceId }}</td>
            <td>{{ item.depositorName }}</td>
            <td>{{ item.toAccount }}</td>
            <td>{{ item.chequeNumber }}</td>
            <td>{{ item.chequeDate }}</td>
            <td>{{ item.bankName }}</td>
            <td>{{ item.branchName }}</td>
            <td>{{ item.amount | currency:'INR' }}</td>
            <td>{{ item.status }}</td>
            <td>{{ item.attachmentName || '-' }}</td>
          </tr>
          <tr *ngIf="savedDeposits.length === 0">
            <td colspan="10" class="empty-state">No cheque deposits saved yet.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </ng-container>

  <!-- Banker User View: Cheque Deposits List with Actions -->
  <ng-container *ngIf="userType === 'banker'">
    <div class="banker-section">
      <h3>Cheque Deposits Management</h3>
      <p class="banker-intro">Review and manage all submitted cheque deposits</p>
      <div class="status-filter-row">
        <label for="statusFilter">Filter by Status</label>
        <select id="statusFilter" name="statusFilter" [(ngModel)]="selectedStatusFilter">
          <option value="ALL">All</option>
          <option value="Not received">Not received</option>
          <option value="Received">Received</option>
          <option value="Sent for Clearance">Sent for Clearance</option>
        </select>
      </div>
      <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>
      
      <table class="banker-table">
        <thead>
          <tr>
            <th>Reference ID</th>
            <th>Depositor</th>
            <th>Account</th>
            <th>Cheque No.</th>
            <th>Date</th>
            <th>Bank</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of getFilteredDeposits()">
            <td>{{ item.referenceId }}</td>
            <td>{{ item.depositorName }}</td>
            <td>{{ item.toAccount }}</td>
            <td>{{ item.chequeNumber }}</td>
            <td>{{ item.chequeDate }}</td>
            <td>{{ item.bankName }}</td>
            <td>{{ item.amount | currency:'INR' }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(item.status)">
                {{ item.status }}
              </span>
            </td>
            <td class="actions-cell">
              <button 
                class="action-btn received-btn" 
                (click)="markAsReceived(item.referenceId)"
                [disabled]="item.status === 'Received' || isUpdatingStatus"
                title="Mark as Received"
              >
                ✓ Received
              </button>
              <button 
                class="action-btn clearance-btn" 
                (click)="sendForClearance(item.referenceId)"
                [disabled]="item.status === 'Sent for Clearance' || isUpdatingStatus"
                title="Send for Clearance"
              >
                ↗ Clearance
              </button>
            </td>
          </tr>
          <tr *ngIf="getFilteredDeposits().length === 0">
            <td colspan="9" class="empty-state">No cheque deposits to manage.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </ng-container>
</div>
